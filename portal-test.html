<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>最小テスト</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; padding: 40px; text-align: center; background: #f8f9fa; }
        h1 { color: #333; }
        #status { font-size: 18px; font-weight: bold; color: #007bff; margin: 30px 0; }
        #buttons button { margin: 10px; padding: 12px 24px; font-size: 16px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 8px; }
        #buttons button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>最小テスト - エリア表示</h1>
    <p id="status">読み込み中...</p>
    <div id="buttons"></div>

    <script>
        // Supabase CDNからグローバル変数を使う
        const supabase = window.supabase;

        if (!supabase) {
            document.getElementById('status').innerHTML = 'Supabase CDN 読み込み失敗<br>広告ブロッカーオフ / ネットワーク確認';
            return;
        }

        // 超シンプルクエリ
        supabase
            .from('hotels')
            .select('prefecture')
            .not('prefecture', 'is', null)
            .limit(10)
            .then(({ data, error }) => {
                const status = document.getElementById('status');
                const buttons = document.getElementById('buttons');

                if (error) {
                    status.innerHTML = 'クエリエラー: ' + error.message;
                    return;
                }

                if (!data || data.length === 0) {
                    status.textContent = 'データ0件です（prefectureカラムを確認）';
                    return;
                }

                status.textContent = '取得完了！都道府県一覧';

                const unique = [...new Set(data.map(r => r.prefecture))];
                unique.forEach(pref => {
                    const btn = document.createElement('button');
                    btn.textContent = pref;
                    buttons.appendChild(btn);
                });
            })
            .catch(err => {
                document.getElementById('status').innerHTML = '予期せぬエラー: ' + err.message;
            });
    </script>
</body>
</html>