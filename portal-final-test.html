<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚¨ãƒªã‚¢è¡¨ç¤ºãƒ†ã‚¹ãƒˆï¼ˆä¿®æ­£å®Œäº†ç‰ˆï¼‰</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { 
            font-family: sans-serif; 
            padding: 40px; 
            background: #f8f9fa; 
            text-align: center; 
        }
        h1 { color: #333; margin-bottom: 20px; }
        #status { 
            font-size: 18px; 
            font-weight: bold; 
            color: #007bff; 
            margin: 30px 0; 
        }
        #container { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 12px; 
        }
        button { 
            padding: 12px 24px; 
            font-size: 16px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: background 0.2s; 
        }
        button:hover { background: #0056b3; }
        .error-msg { 
            color: #dc3545; 
            background: #fff5f5; 
            padding: 12px; 
            border-radius: 8px; 
            margin: 20px auto; 
            max-width: 600px; 
        }
    </style>
</head>
<body>
    <h1>ğŸŒ ã‚¨ãƒªã‚¢è¡¨ç¤ºãƒ†ã‚¹ãƒˆï¼ˆä¿®æ­£å®Œäº†ç‰ˆï¼‰</h1>
    <p id="status">èª­ã¿è¾¼ã¿ä¸­...</p>
    <div id="container"></div>

    <script>
        // 1. Supabaseæ¥ç¶šæƒ…å ±ï¼ˆã‚ãªãŸã®ã‚‚ã®ã«ç½®ãæ›ãˆæ¸ˆã¿ï¼‰
        const SUPABASE_URL = 'https://ojkhwbvoaiaqekxrbpdd.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_UqlcQo5CdoPB_1s1ouLX9Q_olbwArKB';

        // 2. CDNèª­ã¿è¾¼ã¿ãƒã‚§ãƒƒã‚¯
        if (!window.supabase) {
            document.getElementById('status').innerHTML = '<span class="error-msg">Supabaseãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ<br>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚„åºƒå‘Šãƒ–ãƒ­ãƒƒã‚«ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„</span>';
        } else {
            // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½œæˆï¼ˆã“ã“ãŒé‡è¦ï¼ï¼‰
            const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

            async function loadPrefectures() {
                try {
                    // hotelsãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã‚¨ãƒªã‚¢ï¼ˆcityï¼‰ã®ãƒªã‚¹ãƒˆã‚’é‡è¤‡ãªã—ã§å–å¾—
                    const { data, error } = await supabaseClient
                        .from('hotels')
                        .select('city');

                    if (error) throw error;

                    // é‡è¤‡ã‚’é™¤å»ã—ã¦ã‚¨ãƒªã‚¢åã®é…åˆ—ã‚’ä½œæˆ
                    const cities = [...new Set(data.map(item => item.city).filter(Boolean))];

                    // ã‚‚ã—ãƒ‡ãƒ¼ã‚¿ãŒç©ºãªã‚‰ãƒ†ã‚¹ãƒˆç”¨ã®ä»®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
                    const displayList = cities.length > 0 ? cities : ["æ±äº¬", "å¤§é˜ª", "åå¤å±‹", "ç¦å²¡", "æœ­å¹Œ", "æ²–ç¸„"];

                    const container = document.getElementById('container');
                    container.innerHTML = '';

                    displayList.forEach(city => {
                        const btn = document.createElement('button');
                        btn.innerText = city;
                        btn.onclick = () => alert(city + ' ãŒé¸æŠã•ã‚Œã¾ã—ãŸ');
                        container.appendChild(btn);
                    });

                    document.getElementById('status').innerText = 'ã‚¨ãƒªã‚¢ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸ';
                } catch (err) {
                    console.error(err);
                    document.getElementById('status').innerHTML = '<span class="error-msg">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + err.message + '</span>';
                }
            }

            // å®Ÿè¡Œ
            loadPrefectures();
        }
    </script>
</body>
</html>